<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHC Digital Twin - LangGraph Powered</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .agent-card {
            transition: all 0.3s ease;
        }

            .agent-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold text-green-700">üåø Green Hill Canarias Digital Twin</h1>
                    <div class="flex items-center space-x-4 text-sm">
                        <span id="connection-status" class="px-3 py-1 bg-green-100 text-green-700 rounded-full">Connected ‚úÖ</span>
                        <span>Mode: Live Production</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8 max-w-6xl">
            <!-- Status Dashboard -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">ü§ñ AI Executive Team Dashboard</h2>
                <p class="text-sm text-gray-600 mb-2">Powered by LangGraph Cloud Deployment</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <p class="text-gray-600">üîó Connected to: <code class="text-xs bg-gray-100 px-1">dgt-1bf5f8c56c9c5dcd9516a1ba62c5ebf1.us.langgraph.app</code></p>
                    </div>
                    <div>
                        <p class="text-gray-600">üìä LangSmith Tracing: <span id="tracing-status" class="text-green-600 font-semibold">Active</span></p>
                    </div>
                </div>
            </div>

            <!-- Agent Selection Grid -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">Select Your AI Executive</h3>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                    <div class="agent-card bg-blue-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('ceo_digital_twin')">
                        <div class="text-2xl mb-2">üëë</div>
                        <div class="font-semibold text-sm">CEO Digital Twin</div>
                        <div class="text-xs text-gray-600">Strategic Leadership</div>
                    </div>
                    <div class="agent-card bg-green-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('cfo_agent')">
                        <div class="text-2xl mb-2">üí∞</div>
                        <div class="font-semibold text-sm">CFO Agent</div>
                        <div class="text-xs text-gray-600">Financial Analysis</div>
                    </div>
                    <div class="agent-card bg-purple-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('coo_agent')">
                        <div class="text-2xl mb-2">‚öôÔ∏è</div>
                        <div class="font-semibold text-sm">COO Agent</div>
                        <div class="text-xs text-gray-600">Operations</div>
                    </div>
                    <div class="agent-card bg-yellow-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('agricultural_intelligence')">
                        <div class="text-2xl mb-2">üå±</div>
                        <div class="font-semibold text-sm">Agricultural AI</div>
                        <div class="text-xs text-gray-600">Crop Intelligence</div>
                    </div>
                    <div class="agent-card bg-teal-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('sustainability_agent')">
                        <div class="text-2xl mb-2">‚ôªÔ∏è</div>
                        <div class="font-semibold text-sm">Sustainability</div>
                        <div class="text-xs text-gray-600">ESG Metrics</div>
                    </div>
                </div>
                <div class="text-sm text-gray-600">
                    Selected Agent: <span id="selected-agent" class="font-semibold">CEO Digital Twin</span>
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">Executive Consultation</h3>
                <div class="flex gap-4 mb-4">
                    <select id="agent-select" class="hidden">
                        <option value="ceo_digital_twin">CEO Digital Twin</option>
                        <option value="cfo_agent">CFO Agent</option>
                        <option value="coo_agent">COO Agent</option>
                        <option value="agricultural_intelligence">Agricultural AI</option>
                        <option value="sustainability_agent">Sustainability Agent</option>
                    </select>
                    <input type="text" id="user-input" class="flex-1 p-3 border rounded-lg"
                           placeholder="Ask your question..." onkeypress="if(event.key==='Enter') sendToLangGraph()">
                    <button onclick="sendToLangGraph()"
                            class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                        Send to LangGraph
                    </button>
                </div>

                <div id="response" class="p-4 bg-gray-50 rounded-lg min-h-[200px]">
                    <p class="text-gray-500">Your AI executive's response will appear here...</p>
                </div>

                <div class="mt-4 flex justify-between items-center text-sm">
                    <div id="error-details" class="text-red-600"></div>
                    <div id="langgraph-status" class="text-gray-600"></div>
                </div>
            </div>

            <!-- Debug Info (hidden by default) -->
            <div id="debug-info" class="mt-6 bg-gray-100 p-4 rounded-lg text-xs font-mono hidden">
                <p>Debug information will appear here</p>
            </div>
        </main>
    </div>

    <script>
        // LangGraph Configuration
        const LANGGRAPH_BASE_URL = 'https://dgt-1bf5f8c56c9c5dcd9516a1ba62c5ebf1.us.langgraph.app';
        const LANGGRAPH_API_KEY = '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';

        let currentAgent = 'ceo_digital_twin';

        function selectAgent(agent) {
            currentAgent = agent;
            document.getElementById('agent-select').value = agent;
            document.getElementById('selected-agent').textContent =
                document.querySelector(`[onclick="selectAgent('${agent}')"] .font-semibold`).textContent;

            // Update visual selection
            document.querySelectorAll('.agent-card').forEach(card => {
                card.classList.remove('ring-2', 'ring-blue-500');
            });
            event.target.closest('.agent-card').classList.add('ring-2', 'ring-blue-500');
        }

        async function sendToLangGraph() {
            const input = document.getElementById('user-input').value;
            const responseDiv = document.getElementById('response');
            const errorDiv = document.getElementById('error-details');
            const statusDiv = document.getElementById('langgraph-status');

            if (!input.trim()) {
                alert('Please enter a question');
                return;
            }

            responseDiv.innerHTML = '<div class="text-gray-500 animate-pulse">ü§ñ Processing with LangGraph Cloud...</div>';
            errorDiv.innerHTML = '';
            statusDiv.innerHTML = '‚è≥ Sending request...';

            try {
                // Main endpoint
                const response = await fetch(`${LANGGRAPH_BASE_URL}/runs/invoke`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Api-Key': LANGGRAPH_API_KEY,
                    },
                    body: JSON.stringify({
                        input: {
                            messages: [
                                {
                                    type: "human",
                                    content: input
                                }
                            ]
                        },
                        config: {
                            metadata: {
                                agent_type: currentAgent,
                                source: "github_pages"
                            }
                        }
                    })
                });

                const responseText = await response.text();
                console.log('LangGraph Response:', response.status, responseText);

                if (!response.ok) {
                    // Try alternative endpoint structure
                    throw new Error(`Primary endpoint failed (${response.status}). Trying alternative...`);
                }

                const data = JSON.parse(responseText);
                let finalResponse = 'Processing response...';

                // Extract response from various possible structures
                if (data.output && data.output.messages) {
                    finalResponse = data.output.messages[data.output.messages.length - 1].content;
                } else if (data.messages && data.messages.length > 0) {
                    finalResponse = data.messages[data.messages.length - 1].content;
                } else if (data.result) {
                    finalResponse = data.result;
                } else {
                    finalResponse = JSON.stringify(data, null, 2);
                }

                responseDiv.innerHTML = `
                        <div class="space-y-3">
                            <div class="flex items-center justify-between text-sm text-gray-600">
                                <span class="font-semibold">${currentAgent.replace(/_/g, ' ').toUpperCase()}</span>
                                <span class="text-xs">${new Date().toLocaleTimeString()}</span>
                            </div>
                            <div class="prose prose-sm max-w-none">
                                ${marked.parse ? marked.parse(finalResponse) : finalResponse}
                            </div>
                        </div>
                    `;

                statusDiv.innerHTML = '‚úÖ Response received';
                document.getElementById('user-input').value = '';

            } catch (error) {
                console.error('LangGraph Error:', error);

                // Try alternative approach
                try {
                    const altResponse = await fetch(`${LANGGRAPH_BASE_URL}/invoke`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Api-Key': LANGGRAPH_API_KEY,
                        },
                        body: JSON.stringify({
                            messages: [{ type: "human", content: input }]
                        })
                    });

                    if (altResponse.ok) {
                        const altData = await altResponse.json();
                        responseDiv.innerHTML = `<div class="prose">${JSON.stringify(altData, null, 2)}</div>`;
                        statusDiv.innerHTML = '‚úÖ Connected via alternative endpoint';
                        return;
                    }
                } catch (altError) {
                    console.error('Alternative also failed:', altError);
                }

                responseDiv.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <p class="font-semibold text-red-700">Connection Error</p>
                            <p class="text-sm text-red-600 mt-1">${error.message}</p>
                            <p class="text-xs text-gray-600 mt-2">Please check the browser console for more details.</p>
                        </div>
                    `;
                errorDiv.innerHTML = `‚ùå ${error.message}`;
                statusDiv.innerHTML = '‚ùå Request failed';
            }
        }

        // Initialize on load
        window.onload = function () {
            console.log('GHC Digital Twin initialized');
            console.log('LangGraph URL:', LANGGRAPH_BASE_URL);
            document.getElementById('langgraph-status').innerHTML = 'üü¢ Ready';
        };
    </script>

    <!-- Include marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html></html>