<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHC Digital Twin - LangGraph Powered</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .agent-card { transition: all 0.3s ease; }
        .agent-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .agent-card.selected { ring: 2px solid #3B82F6; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold text-green-700">üåø Green Hill Canarias Digital Twin</h1>
                    <div class="flex items-center space-x-4 text-sm">
                        <span id="connection-status" class="px-3 py-1 bg-green-100 text-green-700 rounded-full">Connected ‚úÖ</span>
                        <span>Mode: Live Production</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8 max-w-6xl">
            <!-- Status Dashboard -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">ü§ñ AI Executive Team Dashboard</h2>
                <p class="text-sm text-gray-600 mb-2">Powered by LangGraph Cloud Deployment</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <p class="text-gray-600">üîó Assistant ID: <code class="text-xs bg-gray-100 px-1">4cc9f4b5-6725-5394-98ba-5f55b15cd94f</code></p>
                    </div>
                    <div>
                        <p class="text-gray-600">üìä LangSmith Tracing: <span id="tracing-status" class="text-green-600 font-semibold">Active</span></p>
                        <p class="text-gray-600 text-xs mt-1">Thread: <span id="current-thread" class="font-mono">Creating...</span></p>
                    </div>
                </div>
            </div>

            <!-- Agent Selection Grid -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4">Select Your AI Executive</h3>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                    <div class="agent-card bg-blue-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('ceo_digital_twin')" id="agent-ceo">
                        <div class="text-2xl mb-2">üëë</div>
                        <div class="font-semibold text-sm">CEO Digital Twin</div>
                        <div class="text-xs text-gray-600">Strategic Leadership</div>
                    </div>
                    <div class="agent-card bg-green-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('cfo_agent')" id="agent-cfo">
                        <div class="text-2xl mb-2">üí∞</div>
                        <div class="font-semibold text-sm">CFO Agent</div>
                        <div class="text-xs text-gray-600">Financial Analysis</div>
                    </div>
                    <div class="agent-card bg-purple-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('coo_agent')" id="agent-coo">
                        <div class="text-2xl mb-2">‚öôÔ∏è</div>
                        <div class="font-semibold text-sm">COO Agent</div>
                        <div class="text-xs text-gray-600">Operations</div>
                    </div>
                    <div class="agent-card bg-yellow-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('agricultural_intelligence')" id="agent-agri">
                        <div class="text-2xl mb-2">üå±</div>
                        <div class="font-semibold text-sm">Agricultural AI</div>
                        <div class="text-xs text-gray-600">Crop Intelligence</div>
                    </div>
                    <div class="agent-card bg-teal-50 p-4 rounded-lg cursor-pointer text-center" onclick="selectAgent('sustainability_agent')" id="agent-sustain">
                        <div class="text-2xl mb-2">‚ôªÔ∏è</div>
                        <div class="font-semibold text-sm">Sustainability</div>
                        <div class="text-xs text-gray-600">ESG Metrics</div>
                    </div>
                </div>
                <div class="text-sm text-gray-600">
                    Selected Agent: <span id="selected-agent" class="font-semibold">CEO Digital Twin</span>
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">Executive Consultation</h3>
                <div class="flex gap-4 mb-4">
                    <input type="text" id="user-input" class="flex-1 p-3 border rounded-lg"
                           placeholder="Ask your question..." onkeypress="if(event.key==='Enter') sendToLangGraph()">
                    <button onclick="sendToLangGraph()"
                            class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                        Send to LangGraph
                    </button>
                </div>

                <div id="response" class="p-4 bg-gray-50 rounded-lg min-h-[200px]">
                    <p class="text-gray-500">Your AI executive's response will appear here...</p>
                </div>

                <div class="mt-4 flex justify-between items-center text-sm">
                    <div id="error-details" class="text-red-600"></div>
                    <div id="langgraph-status" class="text-gray-600"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // LangGraph Configuration - FIXED WITH CORRECT ASSISTANT ID
        const ASSISTANT_ID = '4cc9f4b5-6725-5394-98ba-5f55b15cd94f';
        const LANGGRAPH_BASE_URL = 'https://dgt-1bf5f8c56c9c5dcd9516a1ba62c5ebf1.us.langgraph.app';
        const LANGGRAPH_API_KEY = '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';

        let currentAgent = 'ceo_digital_twin';
        let currentThreadId = null;

        // Create a thread for the session
        async function createThread() {
            try {
                const response = await fetch(`${LANGGRAPH_BASE_URL}/threads`, {
                    method: 'POST',
                    headers: